"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const express_1 = require("express");
const BookingController_1 = require("../../controllers/user/BookingController");
const CreateBookingPaymentUseCase_1 = require("../../../application/useCases/user/booking/CreateBookingPaymentUseCase");
const StripeService_1 = require("../../../infrastructure/services/StripeService");
const BookingRepository_1 = require("../../../infrastructure/repositories/user/BookingRepository");
const AvailabilityRuleRepository_1 = require("../../../infrastructure/repositories/lawyer/AvailabilityRuleRepository");
const ConfirmBookingUseCase_1 = require("../../../application/useCases/user/booking/ConfirmBookingUseCase");
const GetUserAppointmentsUseCase_1 = require("../../../application/useCases/user/GetUserAppointmentsUseCase");
const CancelAppointmentUseCase_1 = require("../../../application/useCases/user/CancelAppointmentUseCase");
const UserAuthMiddleware_1 = require("../../middlewares/UserAuthMiddleware");
const TokenService_1 = require("../../../infrastructure/services/jwt/TokenService");
const UserRepository_1 = require("../../../infrastructure/repositories/user/UserRepository");
const checkUserStatusUseCase_1 = require("../../../application/useCases/user/checkUserStatusUseCase");
const router = (0, express_1.Router)();
const stripeService = new StripeService_1.StripeService();
const bookingRepository = new BookingRepository_1.BookingRepository();
const availabilityRuleRepository = new AvailabilityRuleRepository_1.AvailabilityRuleRepository();
const createBookingPaymentUseCase = new CreateBookingPaymentUseCase_1.CreateBookingPaymentUseCase(stripeService);
const confirmBookingUseCase = new ConfirmBookingUseCase_1.ConfirmBookingUseCase(bookingRepository, stripeService, availabilityRuleRepository);
const getUserAppointmentsUseCase = new GetUserAppointmentsUseCase_1.GetUserAppointmentsUseCase(bookingRepository);
const cancelAppointmentUseCase = new CancelAppointmentUseCase_1.CancelAppointmentUseCase(bookingRepository);
const bookingController = new BookingController_1.BookingController(createBookingPaymentUseCase, confirmBookingUseCase, getUserAppointmentsUseCase, cancelAppointmentUseCase);
const userRepository = new UserRepository_1.UserRepository();
const tokenService = new TokenService_1.TokenService();
const checkUserStatusUseCase = new checkUserStatusUseCase_1.CheckUserStatusUseCase(userRepository);
const authMiddleware = new UserAuthMiddleware_1.UserAuthMiddleware(checkUserStatusUseCase, tokenService);
router.post("/create-checkout-session", (req, res, next) => bookingController.initiatePayment(req, res, next));
router.post("/confirm", (req, res, next) => bookingController.confirmBooking(req, res, next));
router.get("/appointments", (req, res, next) => authMiddleware.execute(req, res, next), (req, res, next) => bookingController.getAppointments(req, res, next));
router.patch("/appointments/:id/cancel", (req, res, next) => authMiddleware.execute(req, res, next), (req, res, next) => bookingController.cancelAppointment(req, res, next));
exports.default = router;
//# sourceMappingURL=bookingRoutes.js.map